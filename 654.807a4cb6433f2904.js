"use strict";(self.webpackChunknmmas_admin_ssr=self.webpackChunknmmas_admin_ssr||[]).push([[654],{9654:(T,b,e)=>{e.r(b),e.d(b,{WalletModule:()=>J});var c=e(177),r=e(6582),p=e(1583),d=e(1635),t=e(3953),l=e(9417),f=e(2489),g=e(7370),C=e(4928);let u=(()=>{class s{static#t=this.type="[Wallet] Transaction Get";constructor(a){this.payload=a}}return s})(),m=(()=>{class s{static#t=this.type="[Wallet] Credit";constructor(a){this.payload=a}}return s})(),I=(()=>{class s{static#t=this.type="[Wallet] Debit";constructor(a){this.payload=a}}return s})();var R=e(8141),G=e(1626),D=e(5312);let j=(()=>{class s{constructor(){this.http=(0,t.WQX)(G.Qq)}getUserTransaction(a){return this.http.get(`${D.c.URL}/wallet.json`,{params:a})}static#t=this.\u0275fac=function(n){return new(n||s)};static#a=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var F=e(8701);let h=class W{constructor(){this.notificationService=(0,t.WQX)(F.J),this.walletService=(0,t.WQX)(j)}static wallet(o){return o.wallet}getUserTransations(o,{payload:a}){return this.walletService.getUserTransaction(a).pipe((0,R.M)({next:n=>{o.patchState({wallet:{consumer_id:n?.consumer_id,balance:n?.balance,transactions:{data:n?.transactions?.data,total:n?.transactions?.total?n?.transactions?.total:n?.transactions?.data?.length}}})},error:n=>{throw o.patchState({wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(n?.error?.message)}}))}credit(o,a){}debit(o,a){}static#t=this.\u0275fac=function(a){return new(a||W)};static#a=this.\u0275prov=t.jDH({token:W,factory:W.\u0275fac})};(0,d.Cg)([(0,r.rc)(u)],h.prototype,"getUserTransations",null),(0,d.Cg)([(0,r.rc)(m)],h.prototype,"credit",null),(0,d.Cg)([(0,r.rc)(I)],h.prototype,"debit",null),(0,d.Cg)([(0,r.MD)()],h,"wallet",null),h=(0,d.Cg)([(0,r.Uw)({name:"wallet",defaults:{wallet:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],h);var $=e(913),E=e(844),_=e(7313),w=e(7506),B=e(4774),S=e(7578),Q=e(9949),P=e(3955),X=e(2723);const U=["confirmationModal"],A=()=>[];function O(s,o){if(1&s){const a=t.RV6();t.j41(0,"app-button",18),t.bIt("click",function(){t.eBV(a);const i=t.XpG();return t.Njj(i.form.valid&&i.ConfirmationModal.openModal("credit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&s){const a=t.XpG();t.HbH("btn btn-animation"),t.Y8G("disabled",!a.form.valid)("spinner",!1),t.R7$(),t.SpI(" ",t.bMT(2,5,"add")," ")}}function x(s,o){if(1&s){const a=t.RV6();t.j41(0,"app-button",19),t.bIt("click",function(){t.eBV(a);const i=t.XpG(),y=t.sdS(24);return t.Njj(+i.balance<+y.value||!!y.value&&i.ConfirmationModal.openModal("debit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&s){const a=t.XpG(),n=t.sdS(24);t.HbH("btn btn-outline"),t.Y8G("spinner",!1)("disabled",+a.balance<+n.value||!n.value),t.R7$(),t.SpI(" ",t.bMT(2,5,"withdraw")," ")}}class v{constructor(){this.document=(0,t.WQX)(c.qQ),this.renderer=(0,t.WQX)(t.sFG),this.store=(0,t.WQX)(r.il),this.formBuilder=(0,t.WQX)(l.ok),this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"amount",dataField:"amount",type:"price"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new C.TB({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new l.MJ("",[l.k0.required]),balance:new l.MJ("",[l.k0.required])}),this.form.controls.consumer_id.valueChanges.subscribe(o=>{o?(this.paginateInitialData.consumer_id=o,this.store.dispatch(new u(this.paginateInitialData)),this.wallet$.subscribe(a=>{let n=a?.transactions?.data?.filter(i=>(i.type_status=i.type?`<div class="status-${i.type}"><span>${i.type.replace(/_/g," ")}</span></div>`:"-",i));this.balance=a?a?.balance:0,this.tableConfig.data=a?n:[],this.tableConfig.total=a?a?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(o){this.paginateInitialData=o;let a=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=a,a&&this.store.dispatch(new u(o))}submit(o){this.form.markAllAsTouched();let a=new m(this.form.value);"debit"===o&&(a=new I(this.form.value)),this.form.valid&&this.store.dispatch(a).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}static#t=this.\u0275fac=function(a){return new(a||v)};static#a=this.\u0275cmp=t.VBU({type:v,selectors:[["app-wallet"]],viewQuery:function(a,n){if(1&a&&t.GBs(U,5),2&a){let i;t.mGM(i=t.lsd())&&(n.ConfirmationModal=i.first)}},decls:33,vars:33,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder","noResultMessage"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-wallet-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(a,n){if(1&a){const i=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),t.nrm(4,"select2",6),t.nI1(5,"translate"),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"translate"),t.k0s()()(),t.j41(9,"div",7)(10,"form",4)(11,"app-page-wrapper",5)(12,"div",8)(13,"div",9)(14,"div",10),t.nrm(15,"i",11),t.k0s(),t.j41(16,"div")(17,"h2"),t.EFF(18),t.nI1(19,"currencySymbol"),t.k0s(),t.j41(20,"h5"),t.EFF(21),t.nI1(22,"translate"),t.k0s()()(),t.nrm(23,"input",12,0),t.nI1(25,"translate"),t.j41(26,"div",13),t.DNE(27,O,3,7,"app-button",14)(28,x,3,7,"app-button",15),t.k0s()()()()()(),t.j41(29,"app-page-wrapper",5)(30,"app-table",16),t.bIt("tableChanged",function(M){return t.eBV(i),t.Njj(n.onTableChange(M))}),t.k0s()(),t.j41(31,"app-confirmation-modal",17,1),t.bIt("confirmed",function(M){return t.eBV(i),t.Njj(n.submit(null==M?null:M.actionToPerform))}),t.k0s()}if(2&a){let i;t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","select_consumer"),t.R7$(),t.FS9("noResultMessage",t.bMT(5,18,"no_data_found")),t.Y8G("data",null!=(i=t.bMT(6,20,n.users$))&&i.length?t.bMT(7,22,n.users$):t.lJ4(32,A))("placeholder",t.bMT(8,24,"select_consumer")),t.R7$(6),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","wallet"),t.R7$(7),t.JRh(t.bMT(19,26,n.balance)),t.R7$(3),t.JRh(t.bMT(22,28,"wallet_balance")),t.R7$(2),t.FS9("placeholder",t.bMT(25,30,"add_withdraw_amount")),t.R7$(4),t.Y8G("hasPermission","wallet.credit"),t.R7$(),t.Y8G("hasPermission","wallet.debit"),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","transactions"),t.R7$(),t.Y8G("dateRange",!0)("tableConfig",n.tableConfig)}},dependencies:[l.qT,l.me,l.Q0,l.BC,l.cb,l.j4,l.JD,$.R6,E.O,_.k,w.Q,B.M,S.v,Q.p,c.Jj,P.D9,X.G]})}(0,d.Cg)([(0,r.l6)(g.b.users)],v.prototype,"users$",void 0),(0,d.Cg)([(0,r.l6)(h.wallet)],v.prototype,"wallet$",void 0),(0,d.Cg)([(0,r.l6)(f.E.setting)],v.prototype,"setting$",void 0);var N=e(1608);const Y=[{path:"",component:v,canActivate:[N.L],data:{permission:"wallet.index"}}];let H=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#a=this.\u0275mod=t.$C({type:s});static#e=this.\u0275inj=t.G2t({imports:[p.iI.forChild(Y),p.iI]})}return s})();var V=e(3887);let J=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#a=this.\u0275mod=t.$C({type:s});static#e=this.\u0275inj=t.G2t({imports:[c.MD,H,V.G,r.rK.forFeature([g.b,h,f.E])]})}return s})()},1608:(T,b,e)=>{e.d(b,{L:()=>d});var c=e(3953),r=e(1583),p=e(6582);let d=(()=>{class t{constructor(){this.store=(0,c.WQX)(p.il),this.router=(0,c.WQX)(r.Ix)}canActivate(f,g){const C=this.store.selectSnapshot(m=>m.account).permissions?.map(m=>m?.name),u=f.data?.permission;return!!(!u||!Array.isArray(u)&&C?.includes(u)||Array.isArray(u)&&u?.length&&u.every(m=>C?.includes(m)))||(this.router.navigate(["/error/403"]),!1)}static#t=this.\u0275fac=function(g){return new(g||t)};static#a=this.\u0275prov=c.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},7578:(T,b,e)=>{e.d(b,{v:()=>r});var c=e(3953);let r=(()=>{class p{constructor(){this._el=(0,c.WQX)(c.aKT)}onInputChange(t){const l=this._el.nativeElement.value;this._el.nativeElement.value=l.replace(/[^0-9]*/g,""),l!==this._el.nativeElement.value&&t.stopPropagation()}static#t=this.\u0275fac=function(l){return new(l||p)};static#a=this.\u0275dir=c.FsC({type:p,selectors:[["input","numbersOnly",""]],hostBindings:function(l,f){1&l&&c.bIt("input",function(C){return f.onInputChange(C)})}})}return p})()}}]);