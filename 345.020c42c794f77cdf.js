"use strict";(self.webpackChunknmmas_admin_ssr=self.webpackChunknmmas_admin_ssr||[]).push([[345],{3345:(T,v,e)=>{e.r(v),e.d(v,{PointModule:()=>V});var c=e(177),l=e(6582),d=e(1583),p=e(1635),t=e(3953),r=e(9417),b=e(7370),C=e(8141);let m=(()=>{class o{static#t=this.type="[Point] Transaction Get";constructor(n){this.payload=n}}return o})(),u=(()=>{class o{static#t=this.type="[Point] Credit";constructor(n){this.payload=n}}return o})(),h=(()=>{class o{static#t=this.type="[Point] Debit";constructor(n){this.payload=n}}return o})();var I=e(1626),D=e(5312);let G=(()=>{class o{constructor(){this.http=(0,t.WQX)(I.Qq)}getUserTransaction(n){return this.http.get(`${D.c.URL}/point.json`,{params:n})}static#t=this.\u0275fac=function(a){return new(a||o)};static#n=this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var R=e(8701);let f=class M{constructor(){this.notificationService=(0,t.WQX)(R.J),this.pointService=(0,t.WQX)(G)}static point(i){return i.point}getUserTransaction(i,{payload:n}){return this.pointService.getUserTransaction(n).pipe((0,C.M)({next:a=>{i.patchState({point:{consumer_id:a?.consumer_id,balance:a?.balance,transactions:{data:a?.transactions?.data,total:a?.transactions?.total?a?.transactions?.total:a?.transactions?.data?.length}}})},error:a=>{throw i.patchState({point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(a?.error?.message)}}))}credit(i,n){}debit(i,n){}static#t=this.\u0275fac=function(n){return new(n||M)};static#n=this.\u0275prov=t.jDH({token:M,factory:M.\u0275fac})};(0,p.Cg)([(0,l.rc)(m)],f.prototype,"getUserTransaction",null),(0,p.Cg)([(0,l.rc)(u)],f.prototype,"credit",null),(0,p.Cg)([(0,l.rc)(h)],f.prototype,"debit",null),(0,p.Cg)([(0,l.MD)()],f,"point",null),f=(0,p.Cg)([(0,l.Uw)({name:"point",defaults:{point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],f);var j=e(4928),_=e(913),F=e(844),$=e(7313),E=e(7506),B=e(4774),Q=e(7578),S=e(9949),W=e(3955);const X=["confirmationModal"],U=()=>[];function A(o,i){if(1&o){const n=t.RV6();t.j41(0,"app-button",18),t.bIt("click",function(){t.eBV(n);const s=t.XpG();return t.Njj(s.form.valid&&s.ConfirmationModal.openModal("credit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&o){const n=t.XpG();t.HbH("btn btn-animation"),t.Y8G("disabled",!n.form.valid)("spinner",!1),t.R7$(),t.SpI(" ",t.bMT(2,5,"add")," ")}}function O(o,i){if(1&o){const n=t.RV6();t.j41(0,"app-button",19),t.bIt("click",function(){t.eBV(n);const s=t.XpG(),y=t.sdS(22);return t.Njj((+s.balance<+y.value||!!y.value)&&s.ConfirmationModal.openModal("debit"))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&o){const n=t.XpG(),a=t.sdS(22);t.HbH("btn btn-outline"),t.Y8G("spinner",!1)("disabled",+n.balance<+a.value||!a.value),t.R7$(),t.SpI(" ",t.bMT(2,5,"withdraw")," ")}}class g{constructor(){this.document=(0,t.WQX)(c.qQ),this.renderer=(0,t.WQX)(t.sFG),this.store=(0,t.WQX)(l.il),this.formBuilder=(0,t.WQX)(r.ok),this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"points",dataField:"amount"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new j.TB({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new r.MJ("",[r.k0.required]),balance:new r.MJ("",[r.k0.required])}),this.form.controls.consumer_id.valueChanges.subscribe(i=>{i?(this.paginateInitialData.consumer_id=i,this.store.dispatch(new m(this.paginateInitialData)),this.point$.subscribe(n=>{let a=n?.transactions?.data?.filter(s=>(s.type_status=s.type?`<div class="status-${s.type}"><span>${s.type.replace(/_/g," ")}</span></div>`:"-",s));this.balance=n?n?.balance:0,this.tableConfig.data=n?a:[],this.tableConfig.total=n?n?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(i){this.paginateInitialData=i;let n=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=n,n&&this.store.dispatch(new m(i))}submit(i){this.form.markAllAsTouched();let n=new u(this.form.value);"debit"===i&&(n=new h(this.form.value)),this.form.valid&&this.store.dispatch(n).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}static#t=this.\u0275fac=function(n){return new(n||g)};static#n=this.\u0275cmp=t.VBU({type:g,selectors:[["app-point"]],viewQuery:function(n,a){if(1&n&&t.GBs(X,5),2&n){let s;t.mGM(s=t.lsd())&&(a.ConfirmationModal=s.first)}},decls:30,vars:25,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-copper-diamond-line"],["type","number","formControlName","balance","placeholder","add / withdraw amount","numbersOnly","",1,"form-control"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(n,a){if(1&n){const s=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),t.nrm(4,"select2",6),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"translate"),t.k0s()()(),t.j41(8,"div",7)(9,"form",4)(10,"app-page-wrapper",5)(11,"div",8)(12,"div",9)(13,"div",10),t.nrm(14,"i",11),t.k0s(),t.j41(15,"div")(16,"h2"),t.EFF(17),t.k0s(),t.j41(18,"h5"),t.EFF(19),t.nI1(20,"translate"),t.k0s()()(),t.nrm(21,"input",12,0),t.j41(23,"div",13),t.DNE(24,A,3,7,"app-button",14)(25,O,3,7,"app-button",15),t.k0s()()()()()(),t.j41(26,"app-page-wrapper",5)(27,"app-table",16),t.bIt("tableChanged",function(P){return t.eBV(s),t.Njj(a.onTableChange(P))}),t.k0s()(),t.j41(28,"app-confirmation-modal",17,1),t.bIt("confirmed",function(P){return t.eBV(s),t.Njj(a.submit(null==P?null:P.actionToPerform))}),t.k0s()}if(2&n){let s;t.R7$(2),t.Y8G("formGroup",a.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","select_consumer"),t.R7$(),t.Y8G("data",null!=(s=t.bMT(5,16,a.users$))&&s.length?t.bMT(6,18,a.users$):t.lJ4(24,U))("placeholder",t.bMT(7,20,"select_consumer")),t.R7$(5),t.Y8G("formGroup",a.form),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","point"),t.R7$(7),t.JRh(null==a.balance?null:a.balance.toFixed(2)),t.R7$(2),t.JRh(t.bMT(20,22,"point_balance")),t.R7$(5),t.Y8G("hasPermission","point.credit"),t.R7$(),t.Y8G("hasPermission","point.debit"),t.R7$(),t.Y8G("gridClass","col-sm-12")("title","transactions"),t.R7$(),t.Y8G("dateRange",!0)("tableConfig",a.tableConfig)}},dependencies:[r.qT,r.me,r.Q0,r.BC,r.cb,r.j4,r.JD,_.R6,F.O,$.k,E.Q,B.M,Q.v,S.p,c.Jj,W.D9]})}(0,p.Cg)([(0,l.l6)(b.b.users)],g.prototype,"users$",void 0),(0,p.Cg)([(0,l.l6)(f.point)],g.prototype,"point$",void 0);var x=e(1608);const N=[{path:"",component:g,canActivate:[x.L],data:{permission:"point.index"}}];let Y=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#n=this.\u0275mod=t.$C({type:o});static#a=this.\u0275inj=t.G2t({imports:[d.iI.forChild(N),d.iI]})}return o})();var H=e(3887);let V=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#n=this.\u0275mod=t.$C({type:o});static#a=this.\u0275inj=t.G2t({imports:[c.MD,Y,H.G,l.rK.forFeature([b.b,f])]})}return o})()},1608:(T,v,e)=>{e.d(v,{L:()=>p});var c=e(3953),l=e(1583),d=e(6582);let p=(()=>{class t{constructor(){this.store=(0,c.WQX)(d.il),this.router=(0,c.WQX)(l.Ix)}canActivate(b,C){const m=this.store.selectSnapshot(h=>h.account).permissions?.map(h=>h?.name),u=b.data?.permission;return!!(!u||!Array.isArray(u)&&m?.includes(u)||Array.isArray(u)&&u?.length&&u.every(h=>m?.includes(h)))||(this.router.navigate(["/error/403"]),!1)}static#t=this.\u0275fac=function(C){return new(C||t)};static#n=this.\u0275prov=c.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},7578:(T,v,e)=>{e.d(v,{v:()=>l});var c=e(3953);let l=(()=>{class d{constructor(){this._el=(0,c.WQX)(c.aKT)}onInputChange(t){const r=this._el.nativeElement.value;this._el.nativeElement.value=r.replace(/[^0-9]*/g,""),r!==this._el.nativeElement.value&&t.stopPropagation()}static#t=this.\u0275fac=function(r){return new(r||d)};static#n=this.\u0275dir=c.FsC({type:d,selectors:[["input","numbersOnly",""]],hostBindings:function(r,b){1&r&&c.bIt("input",function(m){return b.onInputChange(m)})}})}return d})()}}]);