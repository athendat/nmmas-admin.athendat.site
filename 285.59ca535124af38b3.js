"use strict";(self.webpackChunknmmas_admin_ssr=self.webpackChunknmmas_admin_ssr||[]).push([[285,761],{7285:(F,g,r)=>{r.r(g),r.d(g,{RoleModule:()=>L});var o=r(177),h=r(6582),u=r(1583),C=r(1635),e=r(3953),b=r(4409),l=r(93),_=r(844),f=r(7313),d=r(9949),m=r(3955);const $=()=>["/role/create"];function I(n,i){1&n&&(e.j41(0,"div",3)(1,"a",4),e.nrm(2,"i",5),e.EFF(3),e.nI1(4,"translate"),e.k0s()()),2&n&&(e.R7$(),e.Y8G("routerLink",e.lJ4(4,$)),e.R7$(2),e.SpI(" ",e.bMT(4,2,"add_role")," "))}class k{constructor(){this.store=(0,e.WQX)(h.il),this.router=(0,e.WQX)(u.Ix),this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"name",dataField:"name",sortable:!0,sort_direction:"desc"},{title:"created_at",dataField:"created_at",type:"date",sortable:!0,sort_direction:"desc"}],rowActions:[{label:"Edit",actionToPerform:"edit",icon:"ri-pencil-line",permission:"role.edit"},{label:"Delete",actionToPerform:"delete",icon:"ri-delete-bin-line",permission:"role.destroy"}],data:[],total:0},this.store.dispatch(new l.gh)}ngOnInit(){this.role$.subscribe(i=>{console.log(i),this.tableConfig.data=i?i?.data:[],this.tableConfig.total=i?i?.total:0})}onTableChange(i){this.store.dispatch(new l.gh(i))}onActionClicked(i){"edit"===i.actionToPerform?this.edit(i.data):"delete"===i.actionToPerform?this.delete(i.data):"deleteAll"===i.actionToPerform&&this.deleteAll(i.data)}edit(i){this.router.navigateByUrl(`/role/edit/${i.id}`)}delete(i){this.store.dispatch(new l.Cl(i.id))}deleteAll(i){this.store.dispatch(new l.hO(i))}static#e=this.\u0275fac=function(t){return new(t||k)};static#t=this.\u0275cmp=e.VBU({type:k,selectors:[["app-role"]],decls:3,vars:5,consts:[[3,"gridClass","title"],["button","",4,"hasPermission"],[3,"tableChanged","rowClicked","action","tableConfig","hasCheckbox"],["button",""],[1,"align-items-center","btn","btn-theme","d-flex",3,"routerLink"],[1,"ri-add-line"]],template:function(t,s){1&t&&(e.j41(0,"app-page-wrapper",0),e.DNE(1,I,5,5,"div",1),e.j41(2,"app-table",2),e.bIt("tableChanged",function(c){return s.onTableChange(c)})("rowClicked",function(c){return s.edit(c)})("action",function(c){return s.onActionClicked(c)}),e.k0s()()),2&t&&(e.Y8G("gridClass","col-sm-12")("title","roles"),e.R7$(),e.Y8G("hasPermission","role.create"),e.R7$(),e.Y8G("tableConfig",s.tableConfig)("hasCheckbox",!0))},dependencies:[u.Wk,_.O,f.k,d.p,m.D9]})}(0,C.Cg)([(0,h.l6)(b.m.role)],k.prototype,"role$",void 0);var p=r(9417),E=r(1413),M=r(7673),j=r(5558),A=r(1397),G=r(6977),x=r(6532),D=r(7506);function B(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"li")(2,"div",5)(3,"input",8),e.bIt("change",function(a){const c=e.eBV(t).$implicit,v=e.XpG().$implicit,T=e.XpG();return e.Njj("index"===c.name&&c.isChecked?T.checkIndex(a,v):T.onPermissionChecked(a,v))}),e.k0s(),e.j41(4,"label",7),e.EFF(5),e.nI1(6,"titlecase"),e.k0s()()(),e.bVm()}if(2&n){const t=i.$implicit,s=e.XpG(2);e.R7$(3),e.FS9("id",t.permission_id),e.Y8G("name",t.name)("checked",!!(null!=s.selectedPermission&&s.selectedPermission.includes(+t.permission_id)||t.isChecked))("value",t.permission_id),e.R7$(),e.FS9("for",t.permission_id),e.R7$(),e.SpI(" ",e.bMT(6,6,t.name)," ")}}function O(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"div",4)(2,"ul")(3,"li"),e.EFF(4),e.nI1(5,"titlecase"),e.k0s(),e.j41(6,"li")(7,"div",5)(8,"input",6),e.bIt("change",function(a){const c=e.eBV(t).$implicit,v=e.XpG();return e.Njj(v.checkUncheckAll(a,c))}),e.k0s(),e.j41(9,"label",7),e.EFF(10),e.k0s()()(),e.DNE(11,B,7,8,"ng-container",3),e.k0s()(),e.bVm()}if(2&n){const t=i.$implicit;e.R7$(4),e.SpI("",e.bMT(5,8,null==t?null:t.name.replace("_"," "))," "),e.R7$(4),e.Mz_("id","role-",t.id,""),e.Y8G("checked",t.isChecked),e.R7$(),e.Mz_("for","role-",t.id,""),e.R7$(),e.JRh("All"),e.R7$(),e.Y8G("ngForOf",t.module_permissions)}}class R{constructor(){this.store=(0,e.WQX)(h.il),this.selectedPermission=[],this.setPermissions=new e.bkB,this.store.dispatch(new l.Sq)}ngOnChanges(i){let t=i.selectedPermission?.currentValue;this.modules$.subscribe(s=>{s?.map(a=>{a.module_permissions.map(c=>{c.isChecked=t.includes(c.id)})}),s?.filter(a=>{this.updateCheckBoxStatus(a)})})}checkUncheckAll(i,t){t.module_permissions.forEach(s=>{s.isChecked=i.target.checked,this.addPermission(i.target.checked,s?.id,t)})}checkIndex(i,t){t.module_permissions.forEach(s=>{s.isChecked=!1,this.addPermission(!1,s?.id,t)})}onPermissionChecked(i,t){t.module_permissions.forEach(s=>{s.isChecked=!1,"index"===s.name&&(s.isChecked=!s.isChecked,this.addPermission(!0,+s.id,t)),this.addPermission(i.target?.checked,+i?.target?.value,t)})}addPermission(i,t,s){const a=this.selectedPermission.indexOf(Number(t));i?-1===a&&this.selectedPermission.push(Number(t)):this.selectedPermission=this.selectedPermission.filter(c=>c!=Number(t)),this.setPermissions.emit(this.selectedPermission),this.updateCheckBoxStatus(s)}updateCheckBoxStatus(i){let t=0;i.module_permissions.filter(s=>{this.selectedPermission.includes(s.id)&&t++,i.isChecked=i.module_permissions.length<=t})}static#e=this.\u0275fac=function(t){return new(t||R)};static#t=this.\u0275cmp=e.VBU({type:R,selectors:[["app-permissions"]],inputs:{selectedPermission:"selectedPermission"},outputs:{setPermissions:"setPermissions"},features:[e.OA$],decls:5,vars:3,consts:[[1,"row","g-sm-4","g-2"],[1,"col-xl-12"],[1,"row","roles-form"],[4,"ngFor","ngForOf"],[1,"col-12"],[1,"form-check","form-switch"],["type","checkbox",1,"checkbox_animated","form-check-input","checkall",3,"change","id","checked"],[1,"form-check-label","m-0","form-label",3,"for"],["type","checkbox",1,"checkbox_animated","form-check-input","check-it",3,"change","name","id","checked","value"]],template:function(t,s){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.DNE(3,O,12,10,"ng-container",3),e.nI1(4,"async"),e.k0s()()()),2&t&&(e.R7$(3),e.Y8G("ngForOf",e.bMT(4,1,s.modules$)))},dependencies:[o.Sq,o.Jj,o.PV]})}function S(n,i){1&n&&(e.j41(0,"div",11),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"name_is_required")," "))}function Y(n,i){1&n&&(e.j41(0,"div",12),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"permissions_is_required")," "))}(0,C.Cg)([(0,h.l6)(b.m.roleModules)],R.prototype,"modules$",void 0);let y=(()=>{class n{constructor(){this.store=(0,e.WQX)(h.il),this.route=(0,e.WQX)(u.nX),this.router=(0,e.WQX)(u.Ix),this.formBuilder=(0,e.WQX)(p.ok),this.permissions=[],this.destroy$=new E.B,this.form=this.formBuilder.group({name:new p.MJ("",[p.k0.required]),permissions:new p.MJ("",[p.k0.required])})}get permissionControl(){return this.form.get("permissions")}ngOnInit(){this.route.params.pipe((0,j.n)(t=>t.id?this.store.dispatch(new l.HH(t.id)).pipe((0,A.Z)(()=>this.store.select(b.m.selectedRole))):(0,M.of)()),(0,G.Q)(this.destroy$)).subscribe(t=>{this.id=t?.id;let s=t?.permissions.map(a=>a?.id);this.permissions=s,this.form.patchValue({name:t?.name,permissions:s})})}setPermissions(t){Array.isArray(t)&&this.form.controls.permissions.setValue(t)}submit(){this.form.markAllAsTouched();let t=new l.RC(this.form.value);"edit"===this.type&&this.id&&(t=new l.Yl(this.form.value,this.id)),this.form.valid&&this.store.dispatch(t).subscribe({complete:()=>{this.router.navigateByUrl("/role")}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-form-role"]],inputs:{type:"type"},decls:17,vars:17,consts:[[1,"theme-form","theme-form-2","mega-form",3,"ngSubmit","formGroup"],[1,"row"],[3,"label","for","required"],["type","text","name","name","formControlName","name",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngIf"],[1,"mb-3","d-flex"],[1,"form-label-title"],[1,"theme-color","ms-2","required-dot"],["class","mt-0 ms-4 invalid-feedback",4,"ngIf"],[3,"setPermissions","selectedPermission"],[3,"id"],[1,"invalid-feedback"],[1,"mt-0","ms-4","invalid-feedback"]],template:function(s,a){1&s&&(e.j41(0,"form",0),e.bIt("ngSubmit",function(){return a.submit()}),e.j41(1,"div",1)(2,"app-form-fields",2),e.nrm(3,"input",3),e.nI1(4,"translate"),e.DNE(5,S,3,3,"div",4),e.k0s(),e.j41(6,"div",5)(7,"h4",6),e.EFF(8),e.nI1(9,"translate"),e.j41(10,"span",7),e.EFF(11,"*"),e.k0s()(),e.DNE(12,Y,3,3,"div",8),e.k0s(),e.j41(13,"app-permissions",9),e.bIt("setPermissions",function(v){return a.setPermissions(v)}),e.k0s()(),e.j41(14,"app-button",10),e.EFF(15),e.nI1(16,"translate"),e.k0s()()),2&s&&(e.Y8G("formGroup",a.form),e.R7$(2),e.Y8G("label","name")("for","name")("required",!0),e.R7$(),e.FS9("placeholder",e.bMT(4,11,"enter_name")),e.R7$(2),e.Y8G("ngIf",a.form.controls.name.touched&&(null==a.form.controls.name.errors?null:a.form.controls.name.errors.required)),e.R7$(3),e.SpI("",e.bMT(9,13,"permissions")," "),e.R7$(4),e.Y8G("ngIf",a.form.controls.permissions.touched&&a.form.controls.permissions.invalid),e.R7$(),e.Y8G("selectedPermission",a.permissions),e.R7$(),e.Y8G("id","role_btn"),e.R7$(),e.JRh(e.bMT(16,15,"save")))},dependencies:[o.bT,p.qT,p.me,p.BC,p.cb,p.j4,p.JD,x.z,D.Q,R,m.D9]})}return n})(),U=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-create-role"]],decls:2,vars:3,consts:[[3,"gridClass","title"],[3,"type"]],template:function(s,a){1&s&&(e.j41(0,"app-page-wrapper",0),e.nrm(1,"app-form-role",1),e.k0s()),2&s&&(e.Y8G("gridClass","col-xxl-8 col-lg-10 m-auto")("title","create_role"),e.R7$(),e.Y8G("type","create"))},dependencies:[f.k,y]})}return n})(),V=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-edit-role"]],decls:2,vars:3,consts:[[3,"gridClass","title"],[3,"type"]],template:function(s,a){1&s&&(e.j41(0,"app-page-wrapper",0),e.nrm(1,"app-form-role",1),e.k0s()),2&s&&(e.Y8G("gridClass","col-xxl-8 col-lg-10 m-auto")("title","edit_role"),e.R7$(),e.Y8G("type","edit"))},dependencies:[f.k,y]})}return n})();var P=r(1608);const W=[{path:"",component:k,canActivate:[P.L],data:{permission:"role.index"}},{path:"create",component:U,canActivate:[P.L],data:{permission:["role.index","role.create"]}},{path:"edit/:id",component:V,canActivate:[P.L],data:{permission:["role.index","role.edit"]}}];let N=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275mod=e.$C({type:n});static#s=this.\u0275inj=e.G2t({imports:[u.iI.forChild(W),u.iI]})}return n})();var X=r(3887);let L=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275mod=e.$C({type:n});static#s=this.\u0275inj=e.G2t({imports:[o.MD,N,X.G,h.rK.forFeature([b.m])]})}return n})()},1608:(F,g,r)=>{r.d(g,{L:()=>C});var o=r(3953),h=r(1583),u=r(6582);let C=(()=>{class e{constructor(){this.store=(0,o.WQX)(u.il),this.router=(0,o.WQX)(h.Ix)}canActivate(l,_){const f=this.store.selectSnapshot(m=>m.account).permissions?.map(m=>m?.name),d=l.data?.permission;return!!(!d||!Array.isArray(d)&&f?.includes(d)||Array.isArray(d)&&d?.length&&d.every(m=>f?.includes(m)))||(this.router.navigate(["/error/403"]),!1)}static#e=this.\u0275fac=function(_){return new(_||e)};static#t=this.\u0275prov=o.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},6532:(F,g,r)=>{r.d(g,{z:()=>b});var o=r(3953),h=r(177),u=r(3955);const C=["*"];function e(l,_){1&l&&(o.j41(0,"span",1),o.EFF(1,"*"),o.k0s())}let b=(()=>{class l{constructor(){this.class="mb-4 row align-items-center g-2",this.labelClass="form-label-title col-sm-2 mb-0",this.gridClass="col-sm-10"}static#e=this.\u0275fac=function(d){return new(d||l)};static#t=this.\u0275cmp=o.VBU({type:l,selectors:[["app-form-fields"]],inputs:{class:"class",label:"label",labelClass:"labelClass",gridClass:"gridClass",for:"for",required:"required"},ngContentSelectors:C,decls:7,vars:11,consts:[["class","theme-color ms-2 required-dot",4,"ngIf"],[1,"theme-color","ms-2","required-dot"]],template:function(d,m){1&d&&(o.NAR(),o.j41(0,"div")(1,"label"),o.EFF(2),o.nI1(3,"translate"),o.DNE(4,e,2,0,"span",0),o.k0s(),o.j41(5,"div"),o.SdG(6),o.k0s()()),2&d&&(o.HbH(m.class),o.R7$(),o.HbH(m.labelClass),o.BMQ("for",m.for),o.R7$(),o.SpI(" ",o.bMT(3,9,m.label),""),o.R7$(2),o.Y8G("ngIf",m.required),o.R7$(),o.HbH(m.gridClass))},dependencies:[h.bT,u.D9]})}return l})()}}]);